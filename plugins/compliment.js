let handler = async (m, { conn }) => {
    try {
        let userToCompliment;
        
        // التحقق من الإشارة أو الرد
        if (m.mentionedJid && m.mentionedJid.length > 0) {
            userToCompliment = m.mentionedJid[0];
        } else if (m.quoted) {
            userToCompliment = m.quoted.sender;
        }
        
        if (!userToCompliment) {
            return conn.reply(m.chat, `╔═══❰ 💝 مجاملة ❱═══╗
║
║ ❌ يرجى تحديد شخص للمجاملة!
║
║ 📝 *طريقة الاستخدام:*
║ • قم بالرد على رسالته
║ • قم بعمل منشن له @المستخدم
║
╚═══════════════════╝`, m);
        }

        // قائمة المجاملات بالعربية
        const compliments = [
            "أنت رائع تماماً كما أنت! 🌟",
            "لديك حس فكاهي رائع! 😄",
            "أنت شخص مفكر ولطيف للغاية. 💭",
            "أنت أقوى مما تعتقد! 💪",
            "أنت تضيء المكان! ✨",
            "أنت صديق حقيقي. 🤝",
            "أنت تلهمني! 🌈",
            "إبداعك لا حدود له! 🎨",
            "لديك قلب من ذهب. 💛",
            "أنت تحدث فرقاً في العالم. 🌍",
            "إيجابيتك معدية! 😊",
            "لديك أخلاقيات عمل مذهلة. 📈",
            "أنت تبرز الأفضل في الناس. 🌺",
            "ابتسامتك تنير يوم الجميع. 😁",
            "أنت موهوب في كل ما تفعله. 🎯",
            "لطفك يجعل العالم مكاناً أفضل. 🌸",
            "لديك وجهة نظر فريدة ورائعة. 👀",
            "حماسك ملهم حقاً! 🔥",
            "أنت قادر على تحقيق أشياء عظيمة. 🏆",
            "تعرف دائماً كيف تجعل شخصاً ما يشعر بالتميز. 💫",
            "ثقتك بنفسك تستحق الإعجاب. 👑",
            "لديك روح جميلة. 🦋",
            "كرمك لا حدود له. 🎁",
            "لديك عين رائعة للتفاصيل. 🔍",
            "شغفك محفز حقاً! ❤️",
            "أنت مستمع رائع. 👂",
            "أنت أقوى مما تظن! 💎",
            "ضحكتك معدية. 😂",
            "لديك موهبة طبيعية لجعل الآخرين يشعرون بالتقدير. 🌹",
            "أنت تجعل العالم مكاناً أفضل بمجرد وجودك فيه. 🌏"
        ];

        // اختيار مجاملة عشوائية
        const compliment = compliments[Math.floor(Math.random() * compliments.length)];

        // تأخير بسيط لتجنب حد المعدل
        await new Promise(resolve => setTimeout(resolve, 1000));

        // إرسال المجاملة
        const message = `╔═══❰ 💝 مجاملة خاصة ❱═══╗
║
║ 👤 إلى: @${userToCompliment.split('@')[0]}
║
║ ━━━━━━━━━━━━━━
║
║ ${compliment}
║
║ ━━━━━━━━━━━━━━
║
║ 💕 مع أطيب التمنيات!
║
╚═══════════════════╝`;

        await conn.reply(m.chat, message, m, { mentions: [userToCompliment] });

    } catch (error) {
        console.error('خطأ في المجاملة:', error);
        
        if (error.data === 429) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            return conn.reply(m.chat, `╔═══❰ ⚠️ تحذير ❱═══╗
║
║ ⏳ يرجى الانتظار قليلاً
║ 🔄 ثم حاول مرة أخرى
║
╚═══════════════════╝`, m);
        }
        
        conn.reply(m.chat, `╔═══❰ ⚠️ خطأ ❱═══╗
║
║ ❌ حدث خطأ في إرسال المجاملة
║
╚═══════════════════╝`, m);
    }
};

handler.help = ['مجاملة <@مستخدم>'];
handler.tags = ['fun'];
handler.command = /^(مجاملة|compliment|praise)$/i;

export default handler;
