/*\n✨ تم التطوير بواسطة: Hilman\n💫 اسم الميزة: التسجيل\n🤖 النوع: إضافة ESM\n🔗 المصدر: https://whatsapp.com/channel/0029Vb6gsqN8fewx89iCtV19\n*/\n\nimport { createHash } from \'crypto\'\nimport moment from \'moment-timezone\'\n\n// Regex to validate name (including Arabic characters) and age\nlet Reg = /^([\\p{L}\\s]+),(\\d{1,3})$/u\n\nlet handler = async function (m, { text, usedPrefix, command, conn }) {\n  let d = new Date(new Date() + 3600000)\n  let locale = \'ar-SA\' // Using Saudi Arabia locale for Arabic\n  let week = d.toLocaleDateString(locale, { weekday: \'long\' })\n  let date = d.toLocaleDateString(locale, { day: \'numeric\', month: \'long\', \'year\': \'numeric\' })\n  let time = d.toLocaleTimeString(locale, { hour: \'numeric\', minute: \'numeric\', second: \'numeric\', hour12: true })\n  \n  let pp\n  try {\n    pp = await conn.profilePictureUrl(m.sender, \'image\')\n  } catch {\n    pp = \'https://telegra.ph/file/24fa902ead26340f3df2c.png\' // Default avatar\n  }\n\n  let user = global.db.data.users[m.sender]\n  let sn = createHash(\'md5\').update(m.sender).digest(\'hex\')\n\n  if (user.registered) {\n    let oldname = user.name\n    let oldage = user.age\n    let oldreg = user.regTime\n    \n    let caption = `\n❗ *أنت مسجل بالفعل*\n\n*الاسم:* ${oldname}\n*العمر:* ${oldage} سنة\n\nإذا كنت ترغب في إعادة التسجيل، استخدم الأمر التالي:\n*${usedPrefix}unreg ${sn}*\n`\n    return conn.reply(m.chat, caption, m)\n  }\n\n  if (!Reg.test(text)) {\n    return m.reply(`*تنسيق غير صحيح*\\n\\nالاستخدام الصحيح:\\n*${usedPrefix + command}* اسمك,عمرك\\n\\n*مثال:*\\n*${usedPrefix + command}* أحمد,25`)\n  }\n\n  let [_, name, ageStr] = text.match(Reg)\n  let age = parseInt(ageStr)\n\n  if (!name || !age) return m.reply(\'*الاسم أو العمر غير صالح!*\')\n  if (name.length > 30) return m.reply(\'الاسم طويل جدًا، بحد أقصى 30 حرفًا.\')\n  if (age < 10 || age > 80) return m.reply(\'يجب أن يكون العمر بين 10 - 80 سنة.\')\n\n  user.name = name.trim()\n  user.age = age\n  user.regTime = +new Date()\n  user.registered = true\n\n  let caption = `\n┌─「 *✅ تم التسجيل بنجاح* 」\n│ \n│- *الاسم:* ${name}\n│- *العمر:* ${age} سنة\n│- *التاريخ:* ${date}\n│- *الوقت:* ${time}\n│- *الرقم التسلسلي:* \n│  \`${sn}\`\n│ \n└─「 *CRIMSON - BOT* 」\n\nمرحبًا بك! لقد أصبحت الآن جزءًا من مجتمعنا.\nاستخدم الأمر *.القائمة* لعرض جميع الأوامر المتاحة.\n`.trim()\n\n  await conn.sendMessage(m.chat, {\n    image: { url: pp },\n    caption: caption,\n    contextInfo: {\n      externalAdReply: {\n        title: \"تم التسجيل بنجاح\",\n        body: user.name,\n        thumbnailUrl: pp,\n        sourceUrl: \"https://whatsapp.com/channel/0029Vb6gsqN8fewx89iCtV19\",\n        mediaType: 1,\n        renderLargerThumbnail: true\n      }\n    }\n  }, { quoted: m })\n}\n\nhandler.help = [\'تسجيل <اسم>,<عمر>\']\nhandler.tags = [\'main\']\nhandler.command = /^(daftar|register|reg|تسجيل|verify|تحقق)$/i\n\nexport default handler\n